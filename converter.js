"use strict";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function t(t,e,n,i){return new(n||(n=Promise))((function(o,r){function l(t){try{a(i.next(t))}catch(t){r(t)}}function c(t){try{a(i.throw(t))}catch(t){r(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(l,c)}a((i=i.apply(t,e||[])).next())}))}Object.defineProperty(exports,"__esModule",{value:!0});const{readlinkSync:e,lstatSync:n}=require("fs"),i=require("path"),o=require("axios");function r(e,n){return t(this,void 0,void 0,(function*(){return(yield o.get("http://localhost:3333",{params:{fileLink:e,sourcePath:n}})).data}))}const l=(e,n)=>t(void 0,void 0,void 0,(function*(){let t=e,i=v(e),o=i.filter((t=>"wiki"===t.type));for(let e of o){let i=yield c("markdown",e.linkText,e.altOrBlockRef,n);t=t.replace(e.match,i)}let r=i.filter((t=>"wikiTransclusion"===t.type));for(let e of r){let i=yield c("mdTransclusion",e.linkText,e.altOrBlockRef,n);t=t.replace(e.match,i)}return t})),c=(o,l,c,a)=>t(void 0,void 0,void 0,(function*(){let t,s=l,u=decodeURI(s),f=n(a.full_source).isSymbolicLink()?e(a.full_source):a.full_source,h=yield r(u,f);return"markdown"===o?(s=function(t){let e;return e=i.join(t.vault.adapter.basePath,"/",t.path),e}(h),t=""!==c?c:h?h.basename:s,`[${t}](${encodeURI(s)})`):"mdTransclusion"===o?(s=function(t){let e,n=t.content,i=/abbrlink\:\s(\w+)/,o=n.match(i);return e=o?"post/"+o[1]:"404",e}(h),`<a href="/${s}" data-pjax-state></a>`):""}));const a=/\[\[(.*?)#.*?\]\]/,s=/(?<=\[\[)(.*)(?=#)/,u=/(?<=#).*?(?=]])/,f=/\[.*?]\((.*?)#.*?\)/,h=/(?<=\]\()(.*)(?=#)/,d=/(?<=#).*?(?=\))/,p=t=>f.test(t),k=t=>{let e=a.test(t),n=f.test(t);if(e||n){let n=t.match(e?s:h);if(n)return n[0]}return""},m=t=>{let e=a.test(t),n=f.test(t);if(e||n){let n=t.match(e?u:d);if(n)return n[0]}return""},v=t=>{const e=[];let n=t,i=n.match(/\!*\[\[.*?\]\]/g);if(i){let t=/(?<=\[\[).*?(?=(\]|\|))/,n=/(?<=\|).*(?=]])/;for(let r of i){if(o=r,a.test(o)){let t=k(r),n=m(r);if(""!==t&&""!==n){let i={type:"wikiTransclusion",match:r,linkText:t,altOrBlockRef:n};e.push(i);continue}}let i=r.match(t);if(i){if(i[0].startsWith("http"))continue;let t=r.match(n),o={type:"wiki",match:r,linkText:i[0],altOrBlockRef:t?t[0]:""};e.push(o)}}}var o;let r=n.match(/\[(^$|.*?)\]\((.*?)\)/g);if(r){let t=/(?<=\().*(?=\))/,n=/(?<=\[)(^$|.*?)(?=\])/;for(let i of r){if(p(i)){let t=k(i),n=m(i);if(""!==t&&""!==n){let o={type:"mdTransclusion",match:i,linkText:t,altOrBlockRef:n};e.push(o);continue}}let o=i.match(t);if(o){if(o[0].startsWith("http"))continue;let t=i.match(n),r={type:"markdown",match:i,linkText:o[0],altOrBlockRef:t?t[0]:""};e.push(r)}}}return e};exports.convertLinks=e=>t(void 0,void 0,void 0,(function*(){let t=e.content;return yield l(t,e)})),exports.convertWikiLinksToMarkdown=l,exports.getFirstLinkpathDest=r;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udmVydGVyLmpzIiwic291cmNlcyI6WyJub2RlX21vZHVsZXMvdHNsaWIvdHNsaWIuZXM2LmpzIiwic3JjL2NvbnZlcnRlci50cyJdLCJzb3VyY2VzQ29udGVudCI6bnVsbCwibmFtZXMiOlsiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsInJlYWRsaW5rU3luYyIsImxzdGF0U3luYyIsInJlcXVpcmUiLCJwYXRoIiwiYXhpb3MiLCJnZXRGaXJzdExpbmtwYXRoRGVzdCIsImZpbGVMaW5rIiwic291cmNlUGF0aCIsImdldCIsInBhcmFtcyIsImRhdGEiLCJjb252ZXJ0V2lraUxpbmtzVG9NYXJrZG93biIsIm1kIiwic291cmNlRmlsZSIsIm5ld01kVGV4dCIsImxpbmtNYXRjaGVzIiwiZ2V0QWxsTGlua01hdGNoZXNJbkZpbGUiLCJ3aWtpTWF0Y2hlcyIsImZpbHRlciIsIm1hdGNoIiwidHlwZSIsIndpa2lNYXRjaCIsIm1kTGluayIsImNyZWF0ZUxpbmsiLCJsaW5rVGV4dCIsImFsdE9yQmxvY2tSZWYiLCJyZXBsYWNlIiwid2lraVRyYW5zY2x1c2lvbnMiLCJ3aWtpVHJhbnNjbHVzaW9uIiwid2lraVRyYW5zY2x1c2lvbkxpbmsiLCJkZXN0Iiwib3JpZ2luYWxMaW5rIiwiYWx0VGV4dCIsImZpbmFsTGluayIsImRlY29kZVVSSSIsImZpbGVQYXRoIiwiZnVsbF9zb3VyY2UiLCJpc1N5bWJvbGljTGluayIsImZpbGUiLCJqb2luIiwidmF1bHQiLCJhZGFwdGVyIiwiYmFzZVBhdGgiLCJnZXRBYnNvbHV0ZUxpbmsiLCJiYXNlbmFtZSIsImVuY29kZVVSSSIsImFiYnJMaW5rIiwiZmlsZVRleHQiLCJjb250ZW50IiwiYWJicmxpbmtSZWdleCIsImFiYnJsaW5rTWF0Y2hlcyIsImdldEFiYnJsaW5rIiwid2lraVRyYW5zY2x1c2lvblJlZ2V4Iiwid2lraVRyYW5zY2x1c2lvbkZpbGVOYW1lUmVnZXgiLCJ3aWtpVHJhbnNjbHVzaW9uQmxvY2tSZWYiLCJtZFRyYW5zY2x1c2lvblJlZ2V4IiwibWRUcmFuc2NsdXNpb25GaWxlTmFtZVJlZ2V4IiwibWRUcmFuc2NsdXNpb25CbG9ja1JlZiIsIm1hdGNoSXNNZFRyYW5zY2x1c2lvbiIsInRlc3QiLCJnZXRUcmFuc2NsdXNpb25GaWxlTmFtZSIsImlzV2lraSIsImlzTWQiLCJmaWxlTmFtZU1hdGNoIiwiZ2V0VHJhbnNjbHVzaW9uQmxvY2tSZWYiLCJibG9ja1JlZk1hdGNoIiwiZmlsZVJlZ2V4IiwiYWx0UmVnZXgiLCJmaWxlTmFtZSIsImxpbmtNYXRjaCIsInB1c2giLCJmaWxlTWF0Y2giLCJzdGFydHNXaXRoIiwiYWx0TWF0Y2giLCJtYXJrZG93bk1hdGNoZXMiLCJtYXJrZG93bk1hdGNoIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFxRU8sU0FBU0EsRUFBVUMsRUFBU0MsRUFBWUMsRUFBR0MsR0FFOUMsT0FBTyxJQUFLRCxJQUFNQSxFQUFJRSxXQUFVLFNBQVVDLEVBQVNDLEdBQy9DLFNBQVNDLEVBQVVDLEdBQVMsSUFBTUMsRUFBS04sRUFBVU8sS0FBS0YsSUFBVyxNQUFPRyxHQUFLTCxFQUFPSyxJQUNwRixTQUFTQyxFQUFTSixHQUFTLElBQU1DLEVBQUtOLEVBQWlCLE1BQUVLLElBQVcsTUFBT0csR0FBS0wsRUFBT0ssSUFDdkYsU0FBU0YsRUFBS0ksR0FKbEIsSUFBZUwsRUFJYUssRUFBT0MsS0FBT1QsRUFBUVEsRUFBT0wsUUFKMUNBLEVBSXlESyxFQUFPTCxNQUpoREEsYUFBaUJOLEVBQUlNLEVBQVEsSUFBSU4sR0FBRSxTQUFVRyxHQUFXQSxFQUFRRyxPQUlUTyxLQUFLUixFQUFXSyxHQUNsR0gsR0FBTU4sRUFBWUEsRUFBVWEsTUFBTWhCLEVBQVNDLEdB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
