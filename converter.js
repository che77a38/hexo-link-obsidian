"use strict";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function t(t,e,n,i){return new(n||(n=Promise))((function(o,l){function r(t){try{a(i.next(t))}catch(t){l(t)}}function c(t){try{a(i.throw(t))}catch(t){l(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,c)}a((i=i.apply(t,e||[])).next())}))}Object.defineProperty(exports,"__esModule",{value:!0});const{readlinkSync:e,lstatSync:n}=require("fs"),i=require("path"),o=require("axios");let l=3333;function r(e,n){return t(this,void 0,void 0,(function*(){return(yield o.get(`http://localhost:${l}`,{params:{fileLink:e,sourcePath:n},timeout:1e3})).data}))}const c=(e,n)=>t(void 0,void 0,void 0,(function*(){let t=e,i=x(e),o=i.filter((t=>"wiki"===t.type));for(let e of o){let i=yield a("markdown",e.linkText,e.altOrBlockRef,n);t=t.replace(e.match,i)}let l=i.filter((t=>"wikiTransclusion"===t.type));for(let e of l){let i=yield a("mdTransclusion",e.linkText,e.altOrBlockRef,n);t=t.replace(e.match,i)}return t})),a=(o,l,c,a)=>t(void 0,void 0,void 0,(function*(){let t=l,s="",u="",f=decodeURI(t),d=n(a.full_source).isSymbolicLink()?e(a.full_source):a.full_source,h=yield r(f,d);return t="md"===h.extension?function(t){let e,n=t.content,i=/^abbrlink\:\s*(\w+)/m,o=n.match(i);return e=o?"post/"+o[1]:"404",e}(h):function(t){let e;return e=i.join(t.vault.adapter.basePath,"/",t.path),e}(h),"markdown"===o?s=""!==c?c:h?h.basename:t:"mdTransclusion"===o&&(u=c,c.startsWith("^")?(u=encodeURI(u.slice(1)),u=`^${u}`):u=encodeURI(u)),["md"].includes(h.extension)?`<a href="/${t}${u&&"#"+u}" data-pjax-state></a>`:["png","jpg","jpeg","gif"].includes(h.extension)?`![${s}](${encodeURI(t)})`:["mp4","webm","ogg"].includes(h.extension)?`<video src="![](${encodeURI(t)})" ${decodeURI(u)}></video>`:`[${s}](${encodeURI(t)})`}));const s=/\[\[(.*?)#.*?\]\]/,u=/(?<=\[\[)(.*)(?=#)/,f=/(?<=#).*?(?=]])/,d=/\[.*?]\((.*?)#.*?\)/,h=/(?<=\]\()(.*)(?=#)/,p=/(?<=#).*?(?=\))/,m=t=>d.test(t),k=t=>{let e=s.test(t),n=d.test(t);if(e||n){let n=t.match(e?u:h);if(n)return n[0]}return""},v=t=>{let e=s.test(t),n=d.test(t);if(e||n){let n=t.match(e?f:p);if(n)return n[0]}return""},x=t=>{const e=[];let n=t,i=n.match(/\!*\[\[.*?\]\]/g);if(i){let t=/(?<=\[\[).*?(?=(\]|\|))/,n=/(?<=\|).*(?=]])/;for(let l of i){if(o=l,s.test(o)){let t=k(l),n=v(l);if(""!==t&&""!==n){let i={type:"wikiTransclusion",match:l,linkText:t,altOrBlockRef:n};e.push(i);continue}}let i=l.match(t);if(i){if(i[0].startsWith("http"))continue;let t=l.match(n),o={type:"wiki",match:l,linkText:i[0],altOrBlockRef:t?t[0]:""};e.push(o)}}}var o;let l=n.match(/\[(^$|.*?)\]\((.*?)\)/g);if(l){let t=/(?<=\().*(?=\))/,n=/(?<=\[)(^$|.*?)(?=\])/;for(let i of l){if(m(i)){let t=k(i),n=v(i);if(""!==t&&""!==n){let o={type:"mdTransclusion",match:i,linkText:t,altOrBlockRef:n};e.push(o);continue}}let o=i.match(t);if(o){if(o[0].startsWith("http"))continue;let t=i.match(n),l={type:"markdown",match:i,linkText:o[0],altOrBlockRef:t?t[0]:""};e.push(l)}}}return e};exports.convertLinks=(e,n=l)=>t(void 0,void 0,void 0,(function*(){l=n;let t=e.content;return yield c(t,e)})),exports.convertWikiLinksToMarkdown=c,exports.getFirstLinkpathDest=r;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udmVydGVyLmpzIiwic291cmNlcyI6WyJub2RlX21vZHVsZXMvdHNsaWIvdHNsaWIuZXM2LmpzIiwic3JjL2NvbnZlcnRlci50cyJdLCJzb3VyY2VzQ29udGVudCI6bnVsbCwibmFtZXMiOlsiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsInJlYWRsaW5rU3luYyIsImxzdGF0U3luYyIsInJlcXVpcmUiLCJwYXRoIiwiYXhpb3MiLCJsaW5rUG9ydCIsImdldEZpcnN0TGlua3BhdGhEZXN0IiwiZmlsZUxpbmsiLCJzb3VyY2VQYXRoIiwiZ2V0IiwicGFyYW1zIiwidGltZW91dCIsImRhdGEiLCJjb252ZXJ0V2lraUxpbmtzVG9NYXJrZG93biIsIm1kIiwic291cmNlRmlsZSIsIm5ld01kVGV4dCIsImxpbmtNYXRjaGVzIiwiZ2V0QWxsTGlua01hdGNoZXNJbkZpbGUiLCJ3aWtpTWF0Y2hlcyIsImZpbHRlciIsIm1hdGNoIiwidHlwZSIsIndpa2lNYXRjaCIsIm1kTGluayIsImNyZWF0ZUxpbmsiLCJsaW5rVGV4dCIsImFsdE9yQmxvY2tSZWYiLCJyZXBsYWNlIiwid2lraVRyYW5zY2x1c2lvbnMiLCJ3aWtpVHJhbnNjbHVzaW9uIiwid2lraVRyYW5zY2x1c2lvbkxpbmsiLCJkZXN0Iiwib3JpZ2luYWxMaW5rIiwiZmluYWxMaW5rIiwiYWx0VGV4dCIsImVuY29kZWRCbG9ja1JlZiIsImRlY29kZVVSSSIsImZpbGVQYXRoIiwiZnVsbF9zb3VyY2UiLCJpc1N5bWJvbGljTGluayIsImZpbGUiLCJleHRlbnNpb24iLCJhYmJyTGluayIsImZpbGVUZXh0IiwiY29udGVudCIsImFiYnJsaW5rUmVnZXgiLCJhYmJybGlua01hdGNoZXMiLCJnZXRBYmJybGluayIsImpvaW4iLCJ2YXVsdCIsImFkYXB0ZXIiLCJiYXNlUGF0aCIsImdldEFic29sdXRlTGluayIsImJhc2VuYW1lIiwic3RhcnRzV2l0aCIsImVuY29kZVVSSSIsInNsaWNlIiwiaW5jbHVkZXMiLCJ3aWtpVHJhbnNjbHVzaW9uUmVnZXgiLCJ3aWtpVHJhbnNjbHVzaW9uRmlsZU5hbWVSZWdleCIsIndpa2lUcmFuc2NsdXNpb25CbG9ja1JlZiIsIm1kVHJhbnNjbHVzaW9uUmVnZXgiLCJtZFRyYW5zY2x1c2lvbkZpbGVOYW1lUmVnZXgiLCJtZFRyYW5zY2x1c2lvbkJsb2NrUmVmIiwibWF0Y2hJc01kVHJhbnNjbHVzaW9uIiwidGVzdCIsImdldFRyYW5zY2x1c2lvbkZpbGVOYW1lIiwiaXNXaWtpIiwiaXNNZCIsImZpbGVOYW1lTWF0Y2giLCJnZXRUcmFuc2NsdXNpb25CbG9ja1JlZiIsImJsb2NrUmVmTWF0Y2giLCJmaWxlUmVnZXgiLCJhbHRSZWdleCIsImZpbGVOYW1lIiwibGlua01hdGNoIiwicHVzaCIsImZpbGVNYXRjaCIsImFsdE1hdGNoIiwibWFya2Rvd25NYXRjaGVzIiwibWFya2Rvd25NYXRjaCIsInBvcnQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQXFFTyxTQUFTQSxFQUFVQyxFQUFTQyxFQUFZQyxFQUFHQyxHQUU5QyxPQUFPLElBQUtELElBQU1BLEVBQUlFLFdBQVUsU0FBVUMsRUFBU0MsR0FDL0MsU0FBU0MsRUFBVUMsR0FBUyxJQUFNQyxFQUFLTixFQUFVTyxLQUFLRixJQUFXLE1BQU9HLEdBQUtMLEVBQU9LLElBQ3BGLFNBQVNDLEVBQVNKLEdBQVMsSUFBTUMsRUFBS04sRUFBaUIsTUFBRUssSUFBVyxNQUFPRyxHQUFLTCxFQUFPSyxJQUN2RixTQUFTRixFQUFLSSxHQUpsQixJQUFlTCxFQUlhSyxFQUFPQyxLQUFPVCxFQUFRUSxFQUFPTCxRQUoxQ0EsRUFJeURLLEVBQU9MLE1BSmhEQSxhQUFpQk4sRUFBSU0sRUFBUSxJQUFJTixHQUFF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
