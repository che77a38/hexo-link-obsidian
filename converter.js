"use strict";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function t(t,e,n,i){return new(n||(n=Promise))((function(o,l){function r(t){try{a(i.next(t))}catch(t){l(t)}}function c(t){try{a(i.throw(t))}catch(t){l(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,c)}a((i=i.apply(t,e||[])).next())}))}Object.defineProperty(exports,"__esModule",{value:!0});const{readlinkSync:e,lstatSync:n}=require("fs"),i=require("path"),o=require("axios");let l=3333;function r(e,n){return t(this,void 0,void 0,(function*(){return(yield o.get(`http://localhost:${l}`,{params:{fileLink:e,sourcePath:n},timeout:1e3})).data}))}let c="posts/";const a=t=>{let e=t,n=e.match(/^abbrlink\:\s*(\w+)/g);return n&&(e=e.replace(n[0],"")),e},s=(e,n)=>t(void 0,void 0,void 0,(function*(){let t=e,i=w(e),o=i.filter((t=>"wiki"===t.type));for(let e of o){let i=yield u("markdown",e.linkText,e.altOrBlockRef,n);t=t.replace(e.match,i)}let l=i.filter((t=>"wikiTransclusion"===t.type));for(let e of l){let i=yield u("mdTransclusion",e.linkText,e.altOrBlockRef,n);t=t.replace(e.match,i)}return t})),u=(o,l,a,s)=>t(void 0,void 0,void 0,(function*(){let t=l,u="",f="",d=decodeURI(t),h=n(s.full_source).isSymbolicLink()?e(s.full_source):s.full_source,p=yield r(d,h);return t="md"===p.extension?function(t){let e,n=t.content,i=/^abbrlink\:\s*([\'\"])*(\w+)\1+?/m,o=n.match(i);return e=o?c+o[2]:"404",e}(p):function(t){let e;return e=i.join(t.vault.adapter.basePath,"/",t.path),e}(p),"markdown"===o?u=""!==a?a:p?p.basename:t:"mdTransclusion"===o&&(f=a,a.startsWith("^")?(f=encodeURI(f.slice(1)),f=`^${f}`):f=encodeURI(f)),["md"].includes(p.extension)?`<a href="/${t}${f&&"#"+f}" data-pjax-state>${u}</a>`:["png","jpg","jpeg","gif"].includes(p.extension)?`![${u}](${encodeURI(t)})`:["mp4","webm","ogg"].includes(p.extension)?`<video src="![](${encodeURI(t)})" ${decodeURI(f)}></video>`:`[${u}](${encodeURI(t)})`}));const f=/\[\[(.*?)#.*?\]\]/,d=/(?<=\[\[)(.*)(?=#)/,h=/(?<=#).*?(?=]])/,p=/\[.*?]\((.*?)#.*?\)/,m=/(?<=\]\()(.*)(?=#)/,k=/(?<=#).*?(?=\))/,v=t=>p.test(t),y=t=>{let e=f.test(t),n=p.test(t);if(e||n){let n=t.match(e?d:m);if(n)return n[0]}return""},x=t=>{let e=f.test(t),n=p.test(t);if(e||n){let n=t.match(e?h:k);if(n)return n[0]}return""},w=t=>{const e=[];let n=t,i=n.match(/\!*\[\[.*?\]\]/g);if(i){let t=/(?<=\[\[).*?(?=(\]|\|))/,n=/(?<=\|).*(?=]])/;for(let l of i){if(o=l,f.test(o)){let t=y(l),n=x(l);if(""!==t&&""!==n){let i={type:"wikiTransclusion",match:l,linkText:t,altOrBlockRef:n};e.push(i);continue}}let i=l.match(t);if(i){if(i[0].startsWith("http"))continue;let t=l.match(n),o={type:"wiki",match:l,linkText:i[0],altOrBlockRef:t?t[0]:""};e.push(o)}}}var o;let l=n.match(/\[(^$|.*?)\]\((.*?)\)/g);if(l){let t=/(?<=\().*(?=\))/,n=/(?<=\[)(^$|.*?)(?=\])/;for(let i of l){if(v(i)){let t=y(i),n=x(i);if(""!==t&&""!==n){let o={type:"mdTransclusion",match:i,linkText:t,altOrBlockRef:n};e.push(o);continue}}let o=i.match(t);if(o){if(o[0].startsWith("http"))continue;let t=i.match(n),l={type:"markdown",match:i,linkText:o[0],altOrBlockRef:t?t[0]:""};e.push(l)}}}return e};exports.convertLinks=(e,n=l,i=c)=>t(void 0,void 0,void 0,(function*(){l=n,c=i;let t=e.content,o=a(t);return o=yield s(t,e),o})),exports.getFirstLinkpathDest=r;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udmVydGVyLmpzIiwic291cmNlcyI6WyJub2RlX21vZHVsZXMvdHNsaWIvdHNsaWIuZXM2LmpzIiwic3JjL2NvbnZlcnRlci50cyJdLCJzb3VyY2VzQ29udGVudCI6bnVsbCwibmFtZXMiOlsiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsInJlYWRsaW5rU3luYyIsImxzdGF0U3luYyIsInJlcXVpcmUiLCJwYXRoIiwiYXhpb3MiLCJsaW5rUG9ydCIsImdldEZpcnN0TGlua3BhdGhEZXN0IiwiZmlsZUxpbmsiLCJzb3VyY2VQYXRoIiwiZ2V0IiwicGFyYW1zIiwidGltZW91dCIsImRhdGEiLCJwZXJtYWxpbmsiLCJjb252ZXJ0Q29tbWVudFN5bWJvbCIsIm1kIiwibmV3TWRUZXh0IiwiY29tbWVudE1hdGNoZXMiLCJtYXRjaCIsInJlcGxhY2UiLCJjb252ZXJ0V2lraUxpbmtzVG9NYXJrZG93biIsInNvdXJjZUZpbGUiLCJsaW5rTWF0Y2hlcyIsImdldEFsbExpbmtNYXRjaGVzSW5GaWxlIiwid2lraU1hdGNoZXMiLCJmaWx0ZXIiLCJ0eXBlIiwid2lraU1hdGNoIiwibWRMaW5rIiwiY3JlYXRlTGluayIsImxpbmtUZXh0IiwiYWx0T3JCbG9ja1JlZiIsIndpa2lUcmFuc2NsdXNpb25zIiwid2lraVRyYW5zY2x1c2lvbiIsIndpa2lUcmFuc2NsdXNpb25MaW5rIiwiZGVzdCIsIm9yaWdpbmFsTGluayIsImZpbmFsTGluayIsImFsdFRleHQiLCJlbmNvZGVkQmxvY2tSZWYiLCJkZWNvZGVVUkkiLCJmaWxlUGF0aCIsImZ1bGxfc291cmNlIiwiaXNTeW1ib2xpY0xpbmsiLCJmaWxlIiwiZXh0ZW5zaW9uIiwiYWJickxpbmsiLCJmaWxlVGV4dCIsImNvbnRlbnQiLCJhYmJybGlua1JlZ2V4IiwiYWJicmxpbmtNYXRjaGVzIiwiZ2V0QWJicmxpbmsiLCJqb2luIiwidmF1bHQiLCJhZGFwdGVyIiwiYmFzZVBhdGgiLCJnZXRBYnNvbHV0ZUxpbmsiLCJiYXNlbmFtZSIsInN0YXJ0c1dpdGgiLCJlbmNvZGVVUkkiLCJzbGljZSIsImluY2x1ZGVzIiwid2lraVRyYW5zY2x1c2lvblJlZ2V4Iiwid2lraVRyYW5zY2x1c2lvbkZpbGVOYW1lUmVnZXgiLCJ3aWtpVHJhbnNjbHVzaW9uQmxvY2tSZWYiLCJtZFRyYW5zY2x1c2lvblJlZ2V4IiwibWRUcmFuc2NsdXNpb25GaWxlTmFtZVJlZ2V4IiwibWRUcmFuc2NsdXNpb25CbG9ja1JlZiIsIm1hdGNoSXNNZFRyYW5zY2x1c2lvbiIsInRlc3QiLCJnZXRUcmFuc2NsdXNpb25GaWxlTmFtZSIsImlzV2lraSIsImlzTWQiLCJmaWxlTmFtZU1hdGNoIiwiZ2V0VHJhbnNjbHVzaW9uQmxvY2tSZWYiLCJibG9ja1JlZk1hdGNoIiwiZmlsZVJlZ2V4IiwiYWx0UmVnZXgiLCJmaWxlTmFtZSIsImxpbmtNYXRjaCIsInB1c2giLCJmaWxlTWF0Y2giLCJhbHRNYXRjaCIsIm1hcmtkb3duTWF0Y2hlcyIsIm1hcmtkb3duTWF0Y2giLCJwb3J0IiwicGVybWFsIiwibmV3RmlsZVRleHQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQXFFTyxTQUFTQSxFQUFVQyxFQUFTQyxFQUFZQyxFQUFHQyxHQUU5QyxPQUFPLElBQUtELElBQU1BLEVBQUlFLFdBQVUsU0FBVUMsRUFBU0MsR0FDL0MsU0FBU0MsRUFBVUMsR0FBUyxJQUFNQyxFQUFLTixFQUFVTyxLQUFLRixJQUFXLE1BQU9HLEdBQUtMLEVBQU9LLElBQ3BGLFNBQVNDLEVBQVNKLEdBQVMsSUFBTUMsRUFBS04sRUFBaUIsTUFBRUssSUFBVyxNQUFPRyxHQUFLTCxFQUFPSyxJQUN2RixTQUFTRixFQUFLSSxHQUpsQixJQUFlTCxFQUlhSyxFQUFP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
