"use strict";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function t(t,e,n,i){return new(n||(n=Promise))((function(o,l){function r(t){try{a(i.next(t))}catch(t){l(t)}}function c(t){try{a(i.throw(t))}catch(t){l(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,c)}a((i=i.apply(t,e||[])).next())}))}Object.defineProperty(exports,"__esModule",{value:!0});const{readlinkSync:e,lstatSync:n}=require("fs"),i=require("path"),o=require("axios");let l=3333;function r(e,n){return t(this,void 0,void 0,(function*(){return(yield o.get(`http://localhost:${l}`,{params:{fileLink:e,sourcePath:n},timeout:1e3})).data}))}const c=t=>{let e=t,n=e.match(/^abbrlink\:\s*(\w+)/g);return n&&(e=e.replace(n[0],"")),e},a=(e,n)=>t(void 0,void 0,void 0,(function*(){let t=e,i=x(e),o=i.filter((t=>"wiki"===t.type));for(let e of o){let i=yield s("markdown",e.linkText,e.altOrBlockRef,n);t=t.replace(e.match,i)}let l=i.filter((t=>"wikiTransclusion"===t.type));for(let e of l){let i=yield s("mdTransclusion",e.linkText,e.altOrBlockRef,n);t=t.replace(e.match,i)}return t})),s=(o,l,c,a)=>t(void 0,void 0,void 0,(function*(){let t=l,s="",u="",f=decodeURI(t),d=n(a.full_source).isSymbolicLink()?e(a.full_source):a.full_source,h=yield r(f,d);return t="md"===h.extension?function(t){let e,n=t.content;console.log(t);let i=/^abbrlink\:\s*(\w+)/m,o=n.match(i);return e=o?"post/"+o[1]:"404",e}(h):function(t){let e;return e=i.join(t.vault.adapter.basePath,"/",t.path),e}(h),"markdown"===o?s=""!==c?c:h?h.basename:t:"mdTransclusion"===o&&(u=c,c.startsWith("^")?(u=encodeURI(u.slice(1)),u=`^${u}`):u=encodeURI(u)),["md"].includes(h.extension)?`<a href="/${t}${u&&"#"+u}" data-pjax-state></a>`:["png","jpg","jpeg","gif"].includes(h.extension)?`![${s}](${encodeURI(t)})`:["mp4","webm","ogg"].includes(h.extension)?`<video src="![](${encodeURI(t)})" ${decodeURI(u)}></video>`:`[${s}](${encodeURI(t)})`}));const u=/\[\[(.*?)#.*?\]\]/,f=/(?<=\[\[)(.*)(?=#)/,d=/(?<=#).*?(?=]])/,h=/\[.*?]\((.*?)#.*?\)/,p=/(?<=\]\()(.*)(?=#)/,m=/(?<=#).*?(?=\))/,k=t=>h.test(t),v=t=>{let e=u.test(t),n=h.test(t);if(e||n){let n=t.match(e?f:p);if(n)return n[0]}return""},y=t=>{let e=u.test(t),n=h.test(t);if(e||n){let n=t.match(e?d:m);if(n)return n[0]}return""},x=t=>{const e=[];let n=t,i=n.match(/\!*\[\[.*?\]\]/g);if(i){let t=/(?<=\[\[).*?(?=(\]|\|))/,n=/(?<=\|).*(?=]])/;for(let l of i){if(o=l,u.test(o)){let t=v(l),n=y(l);if(""!==t&&""!==n){let i={type:"wikiTransclusion",match:l,linkText:t,altOrBlockRef:n};e.push(i);continue}}let i=l.match(t);if(i){if(i[0].startsWith("http"))continue;let t=l.match(n),o={type:"wiki",match:l,linkText:i[0],altOrBlockRef:t?t[0]:""};e.push(o)}}}var o;let l=n.match(/\[(^$|.*?)\]\((.*?)\)/g);if(l){let t=/(?<=\().*(?=\))/,n=/(?<=\[)(^$|.*?)(?=\])/;for(let i of l){if(k(i)){let t=v(i),n=y(i);if(""!==t&&""!==n){let o={type:"mdTransclusion",match:i,linkText:t,altOrBlockRef:n};e.push(o);continue}}let o=i.match(t);if(o){if(o[0].startsWith("http"))continue;let t=i.match(n),l={type:"markdown",match:i,linkText:o[0],altOrBlockRef:t?t[0]:""};e.push(l)}}}return e};exports.convertLinks=(e,n=l)=>t(void 0,void 0,void 0,(function*(){l=n;let t=e.content,i=c(t);return i=yield a(t,e),i})),exports.getFirstLinkpathDest=r;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udmVydGVyLmpzIiwic291cmNlcyI6WyJub2RlX21vZHVsZXMvdHNsaWIvdHNsaWIuZXM2LmpzIiwic3JjL2NvbnZlcnRlci50cyJdLCJzb3VyY2VzQ29udGVudCI6bnVsbCwibmFtZXMiOlsiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsInJlYWRsaW5rU3luYyIsImxzdGF0U3luYyIsInJlcXVpcmUiLCJwYXRoIiwiYXhpb3MiLCJsaW5rUG9ydCIsImdldEZpcnN0TGlua3BhdGhEZXN0IiwiZmlsZUxpbmsiLCJzb3VyY2VQYXRoIiwiZ2V0IiwicGFyYW1zIiwidGltZW91dCIsImRhdGEiLCJjb252ZXJ0Q29tbWVudFN5bWJvbCIsIm1kIiwibmV3TWRUZXh0IiwiY29tbWVudE1hdGNoZXMiLCJtYXRjaCIsInJlcGxhY2UiLCJjb252ZXJ0V2lraUxpbmtzVG9NYXJrZG93biIsInNvdXJjZUZpbGUiLCJsaW5rTWF0Y2hlcyIsImdldEFsbExpbmtNYXRjaGVzSW5GaWxlIiwid2lraU1hdGNoZXMiLCJmaWx0ZXIiLCJ0eXBlIiwid2lraU1hdGNoIiwibWRMaW5rIiwiY3JlYXRlTGluayIsImxpbmtUZXh0IiwiYWx0T3JCbG9ja1JlZiIsIndpa2lUcmFuc2NsdXNpb25zIiwid2lraVRyYW5zY2x1c2lvbiIsIndpa2lUcmFuc2NsdXNpb25MaW5rIiwiZGVzdCIsIm9yaWdpbmFsTGluayIsImZpbmFsTGluayIsImFsdFRleHQiLCJlbmNvZGVkQmxvY2tSZWYiLCJkZWNvZGVVUkkiLCJmaWxlUGF0aCIsImZ1bGxfc291cmNlIiwiaXNTeW1ib2xpY0xpbmsiLCJmaWxlIiwiZXh0ZW5zaW9uIiwiYWJickxpbmsiLCJmaWxlVGV4dCIsImNvbnRlbnQiLCJjb25zb2xlIiwibG9nIiwiYWJicmxpbmtSZWdleCIsImFiYnJsaW5rTWF0Y2hlcyIsImdldEFiYnJsaW5rIiwiam9pbiIsInZhdWx0IiwiYWRhcHRlciIsImJhc2VQYXRoIiwiZ2V0QWJzb2x1dGVMaW5rIiwiYmFzZW5hbWUiLCJzdGFydHNXaXRoIiwiZW5jb2RlVVJJIiwic2xpY2UiLCJpbmNsdWRlcyIsIndpa2lUcmFuc2NsdXNpb25SZWdleCIsIndpa2lUcmFuc2NsdXNpb25GaWxlTmFtZVJlZ2V4Iiwid2lraVRyYW5zY2x1c2lvbkJsb2NrUmVmIiwibWRUcmFuc2NsdXNpb25SZWdleCIsIm1kVHJhbnNjbHVzaW9uRmlsZU5hbWVSZWdleCIsIm1kVHJhbnNjbHVzaW9uQmxvY2tSZWYiLCJtYXRjaElzTWRUcmFuc2NsdXNpb24iLCJ0ZXN0IiwiZ2V0VHJhbnNjbHVzaW9uRmlsZU5hbWUiLCJpc1dpa2kiLCJpc01kIiwiZmlsZU5hbWVNYXRjaCIsImdldFRyYW5zY2x1c2lvbkJsb2NrUmVmIiwiYmxvY2tSZWZNYXRjaCIsImZpbGVSZWdleCIsImFsdFJlZ2V4IiwiZmlsZU5hbWUiLCJsaW5rTWF0Y2giLCJwdXNoIiwiZmlsZU1hdGNoIiwiYWx0TWF0Y2giLCJtYXJrZG93bk1hdGNoZXMiLCJtYXJrZG93bk1hdGNoIiwicG9ydCIsIm5ld0ZpbGVUZXh0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFxRU8sU0FBU0EsRUFBVUMsRUFBU0MsRUFBWUMsRUFBR0MsR0FFOUMsT0FBTyxJQUFLRCxJQUFNQSxFQUFJRSxXQUFVLFNBQVVDLEVBQVNDLEdBQy9DLFNBQVNDLEVBQVVDLEdBQVMsSUFBTUMsRUFBS04sRUFBVU8sS0FBS0YsSUFBVyxNQUFPRyxHQUFLTCxFQUFPSyxJQUNwRixTQUFTQyxFQUFTSixHQUFTLElBQU1DLEVBQUtOLEVBQWlCLE1BQUVLLElBQVcsTUFBT0csR0FBS0wsRUFBT0ssSUFDdkYsU0FBU0YsRUFBS0ksR0FKbEIsSUFBZUwsRUFJYUssRUFBT0MsS0FB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
