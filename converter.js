"use strict";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function t(t,e,n,i){return new(n||(n=Promise))((function(l,o){function r(t){try{a(i.next(t))}catch(t){o(t)}}function c(t){try{a(i.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?l(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,c)}a((i=i.apply(t,e||[])).next())}))}Object.defineProperty(exports,"__esModule",{value:!0});const{readlinkSync:e,lstatSync:n}=require("fs"),i=require("path"),l=require("axios");let o=3333;function r(e,n){return t(this,void 0,void 0,(function*(){return(yield l.get(`http://localhost:${o}`,{params:{fileLink:e,sourcePath:n},timeout:1e3})).data}))}let c="posts/";const a=t=>{let e=t,n=e.match(/^abbrlink\:\s*(\w+)/g);return n&&(e=e.replace(n[0],"")),e},s=(e,n)=>t(void 0,void 0,void 0,(function*(){let t=e,i=R(e),l=i.filter((t=>"wiki"===t.type));for(let e of l){let i=yield u("markdown",e.linkText,e.altOrBlockRef,n);t=t.replace(e.match,i)}let o=i.filter((t=>"wikiTransclusion"===t.type));for(let e of o){let i=yield u("mdTransclusion",e.linkText,e.altOrBlockRef,n);t=t.replace(e.match,i)}return t})),u=(l,o,a,s)=>t(void 0,void 0,void 0,(function*(){let t=o,u="",f="",d=decodeURI(t),h=n(s.full_source).isSymbolicLink()?e(s.full_source):s.full_source,p=yield r(d,h);t="md"===p.extension?function(t){let e,n=t.content,i=/^abbrlink\:\s*([\'\"])*(\w+)\1+?/m,l=n.match(i);return e=l?c+l[2]:"404",e}(p):function(t){let e;return e=i.join(t.vault.adapter.basePath,"/",t.path),e}(p);let m=a.search(/\|/),k=a,v=a;return-1!=m&&(v=a.split("|")[0],k=a.split("|")[1]),u=""!==k?k:p?p.basename:t,"mdTransclusion"===l&&(f=v,a.startsWith("^")?(f=encodeURI(f.slice(1)),f=`^${f}`):f=encodeURI(f)),["md"].includes(p.extension)?`<a href="/${t}${f&&"#"+f}/" data-pjax-state target="_Blank">${u}</a>`:["png","jpg","jpeg","gif"].includes(p.extension)?`![${u}](${encodeURI(t)})`:["mp4","webm","ogg"].includes(p.extension)?`<video src="![](${encodeURI(t)})" ${decodeURI(f)}></video>`:`[${u}](${encodeURI(t)})`}));const f=/\[\[(.*?)#.*?\]\]/,d=/(?<=\[\[)(.*)(?=#)/,h=/(?<=#).*?(?=]])/,p=/\[.*?]\((.*?)#.*?\)/,m=/(?<=\]\()(.*)(?=#)/,k=/(?<=#).*?(?=\))/,v=t=>p.test(t),y=t=>{let e=f.test(t),n=p.test(t);if(e||n){let n=t.match(e?d:m);if(n)return n[0]}return""},x=t=>{let e=f.test(t),n=p.test(t);if(e||n){let n=t.match(e?h:k);if(n)return n[0]}return""},R=t=>{const e=[];let n=t,i=n.match(/\!*\[\[.*?\]\]/g);if(i){let t=/(?<=\[\[).*?(?=(\]|\|))/,n=/(?<=\|).*(?=]])/;for(let o of i){if(l=o,f.test(l)){let t=y(o),n=x(o);if(""!==t&&""!==n){let i={type:"wikiTransclusion",match:o,linkText:t,altOrBlockRef:n};e.push(i);continue}}let i=o.match(t);if(i){let t=o.match(n),l={type:"wiki",match:o,linkText:i[0],altOrBlockRef:t?t[0]:""};e.push(l)}}}var l;let o=n.match(/\[(^$|.*?)\]\((.*?)\)/g);if(o){let t=/(?<=\().*(?=\))/,n=/(?<=\[)(^$|.*?)(?=\])/;for(let i of o){if(v(i)){let t=y(i),n=x(i);if(""!==t&&""!==n){let l={type:"mdTransclusion",match:i,linkText:t,altOrBlockRef:n};e.push(l);continue}}let l=i.match(t);if(l){if(l[0].startsWith("http"))continue;let t=i.match(n),o={type:"markdown",match:i,linkText:l[0],altOrBlockRef:t?t[0]:""};e.push(o)}}}return e};exports.convertLinks=(e,n=o,i=c)=>t(void 0,void 0,void 0,(function*(){o=n,c=i;let t=e.content,l=a(t);return l=yield s(t,e),l})),exports.getFirstLinkpathDest=r;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udmVydGVyLmpzIiwic291cmNlcyI6WyJub2RlX21vZHVsZXMvdHNsaWIvdHNsaWIuZXM2LmpzIiwic3JjL2NvbnZlcnRlci50cyJdLCJzb3VyY2VzQ29udGVudCI6bnVsbCwibmFtZXMiOlsiX19hd2FpdGVyIiwidGhpc0FyZyIsIl9hcmd1bWVudHMiLCJQIiwiZ2VuZXJhdG9yIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJmdWxmaWxsZWQiLCJ2YWx1ZSIsInN0ZXAiLCJuZXh0IiwiZSIsInJlamVjdGVkIiwicmVzdWx0IiwiZG9uZSIsInRoZW4iLCJhcHBseSIsInJlYWRsaW5rU3luYyIsImxzdGF0U3luYyIsInJlcXVpcmUiLCJwYXRoIiwiYXhpb3MiLCJsaW5rUG9ydCIsImdldEZpcnN0TGlua3BhdGhEZXN0IiwiZmlsZUxpbmsiLCJzb3VyY2VQYXRoIiwiZ2V0IiwicGFyYW1zIiwidGltZW91dCIsImRhdGEiLCJwZXJtYWxpbmsiLCJjb252ZXJ0Q29tbWVudFN5bWJvbCIsIm1kIiwibmV3TWRUZXh0IiwiY29tbWVudE1hdGNoZXMiLCJtYXRjaCIsInJlcGxhY2UiLCJjb252ZXJ0V2lraUxpbmtzVG9NYXJrZG93biIsInNvdXJjZUZpbGUiLCJsaW5rTWF0Y2hlcyIsImdldEFsbExpbmtNYXRjaGVzSW5GaWxlIiwid2lraU1hdGNoZXMiLCJmaWx0ZXIiLCJ0eXBlIiwid2lraU1hdGNoIiwibWRMaW5rIiwiY3JlYXRlTGluayIsImxpbmtUZXh0IiwiYWx0T3JCbG9ja1JlZiIsIndpa2lUcmFuc2NsdXNpb25zIiwid2lraVRyYW5zY2x1c2lvbiIsIndpa2lUcmFuc2NsdXNpb25MaW5rIiwiZGVzdCIsIm9yaWdpbmFsTGluayIsImZpbmFsTGluayIsImFsdFRleHQiLCJlbmNvZGVkQmxvY2tSZWYiLCJkZWNvZGVVUkkiLCJmaWxlUGF0aCIsImZ1bGxfc291cmNlIiwiaXNTeW1ib2xpY0xpbmsiLCJmaWxlIiwiZXh0ZW5zaW9uIiwiYWJickxpbmsiLCJmaWxlVGV4dCIsImNvbnRlbnQiLCJhYmJybGlua1JlZ2V4IiwiYWJicmxpbmtNYXRjaGVzIiwiZ2V0QWJicmxpbmsiLCJqb2luIiwidmF1bHQiLCJhZGFwdGVyIiwiYmFzZVBhdGgiLCJnZXRBYnNvbHV0ZUxpbmsiLCJhbHRPckJsb2NrUmVmQ29udGFpblZlcnRpY2FsQmFyIiwic2VhcmNoIiwiYWx0VGV4dFNvdXJjZSIsImFsdE9yQmxvY2tSZWZTb3VyY2UiLCJzcGxpdCIsImJhc2VuYW1lIiwic3RhcnRzV2l0aCIsImVuY29kZVVSSSIsInNsaWNlIiwiaW5jbHVkZXMiLCJ3aWtpVHJhbnNjbHVzaW9uUmVnZXgiLCJ3aWtpVHJhbnNjbHVzaW9uRmlsZU5hbWVSZWdleCIsIndpa2lUcmFuc2NsdXNpb25CbG9ja1JlZiIsIm1kVHJhbnNjbHVzaW9uUmVnZXgiLCJtZFRyYW5zY2x1c2lvbkZpbGVOYW1lUmVnZXgiLCJtZFRyYW5zY2x1c2lvbkJsb2NrUmVmIiwibWF0Y2hJc01kVHJhbnNjbHVzaW9uIiwidGVzdCIsImdldFRyYW5zY2x1c2lvbkZpbGVOYW1lIiwiaXNXaWtpIiwiaXNNZCIsImZpbGVOYW1lTWF0Y2giLCJnZXRUcmFuc2NsdXNpb25CbG9ja1JlZiIsImJsb2NrUmVmTWF0Y2giLCJmaWxlUmVnZXgiLCJhbHRSZWdleCIsImZpbGVOYW1lIiwibGlua01hdGNoIiwicHVzaCIsImZpbGVNYXRjaCIsImFsdE1hdGNoIiwibWFya2Rvd25NYXRjaGVzIiwibWFya2Rvd25NYXRjaCIsInBvcnQiLCJwZXJtYWwiLCJuZXdGaWxlVGV4dCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBcUVPLFNBQVNBLEVBQVVDLEVBQVNDLEVBQVlDLEVBQUdDLEdBRTlDLE9BQU8sSUFBS0QsSUFBTUEsRUFBSUUsV0FBVSxTQUFVQyxFQUFTQyxHQUMvQyxTQUFTQyxFQUFVQyxHQUFTLElBQU1DLEVBQUtOLEVBQVVPLEtBQUtGLElBQVcsTUFBT0csR0FBS0wsRUFBT0ssSUFDcEYsU0FBU0MsRUFBU0osR0FB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
